<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><title>IQR Vision Utilities | IQR Lab Docs</title><meta name="description" content="">
    <link rel="preload" href="/docs/assets/style-BMhiwD7j.css" as="style"><link rel="stylesheet" href="/docs/assets/style-BMhiwD7j.css">
    <link rel="modulepreload" href="/docs/assets/app-Cb7Gj5tc.js"><link rel="modulepreload" href="/docs/assets/iqr-vision.html-pPPFFoEF.js">
    <link rel="prefetch" href="/docs/assets/index.html-36dPXqGX.js" as="script"><link rel="prefetch" href="/docs/assets/intel-nuc.html-CWxxxW3d.js" as="script"><link rel="prefetch" href="/docs/assets/intel-realsense.html-DG1-ciHE.js" as="script"><link rel="prefetch" href="/docs/assets/kalibr.html-zML1wWt1.js" as="script"><link rel="prefetch" href="/docs/assets/pointcloud-stitching.html-CvPM5ON7.js" as="script"><link rel="prefetch" href="/docs/assets/index.html-DpiJwl6p.js" as="script"><link rel="prefetch" href="/docs/assets/intro.html-DEXW46yi.js" as="script"><link rel="prefetch" href="/docs/assets/index.html-DBcGrgLN.js" as="script"><link rel="prefetch" href="/docs/assets/intro.html-Bo1EvUTp.js" as="script"><link rel="prefetch" href="/docs/assets/intro.html-BRNkg7g1.js" as="script"><link rel="prefetch" href="/docs/assets/index.html-BslO9VAY.js" as="script"><link rel="prefetch" href="/docs/assets/404.html--124Kumq.js" as="script"><link rel="prefetch" href="/docs/assets/setupDevtools-7MC2TMWH-qiMRAZtP.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/docs/"><!----><span class="vp-site-name" aria-hidden="true">IQR Lab Docs</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/iqr-lab/docs" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/iqr-lab/docs" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/docs/" aria-label="Introduction"><!---->Introduction<!----></a><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/docs/" aria-label="IQR Lab Docs"><!---->IQR Lab Docs<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Computer Vision <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/docs/computer-vision/intel-nuc.html" aria-label="Intel NUC"><!---->Intel NUC<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/docs/computer-vision/intel-realsense.html" aria-label="Intel RealSense"><!---->Intel RealSense<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/docs/computer-vision/kalibr.html" aria-label="Kalibr"><!---->Kalibr<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/docs/computer-vision/pointcloud-stitching.html" aria-label="Pointcloud Stitching for IQR Lab"><!---->Pointcloud Stitching for IQR Lab<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/docs/computer-vision/iqr-vision.html" aria-label="IQR Vision Utilities"><!---->IQR Vision Utilities<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Vention <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/docs/vention/intro.html" aria-label="Introduction [Under Construction]"><!---->Introduction [Under Construction]<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Kinova <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/docs/kinova/intro.html" aria-label="Introduction [Under Construction]"><!---->Introduction [Under Construction]<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Website <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/docs/website/intro.html" aria-label="Adding a new lab member"><!---->Adding a new lab member<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="iqr-vision-utilities" tabindex="-1"><a class="header-anchor" href="#iqr-vision-utilities"><span>IQR Vision Utilities</span></a></h1><p>This is a collection of Python utility packages for use with the IQR Vision system. Although much of the code is specific to IQR Lab&#39;s setup, the code is generally useful for similar Realsense camera + edge node systems (see more details <a href="https://iqr.cs.yale.edu/docs/#edge-camera-systems" target="_blank" rel="noopener noreferrer">here</a>).</p><h2 id="installation" tabindex="-1"><a class="header-anchor" href="#installation"><span>Installation</span></a></h2><ol><li><p>Install GNU Parallel <code>gnu-parallel</code> on your computer and all the edge nodes:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> parallel</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Create a <code>.env</code> in your root directory following <code>.env.example</code>.</p></li><li><p>Ensure that you can <code>ssh</code> into each specificied host in the <code>HOSTS</code> variable with the following command format:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">ssh</span> <span class="token punctuation">[</span>hostname<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div> <details><summary>SSH Config Details</summary><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">Host iqr-vision-1</span>
<span class="line">    HostName iqr-vision-1.local</span>
<span class="line">    User lab</span>
<span class="line">    IdentityFile ~/.ssh/iqr-vision-1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details></li><li><p>Clone <a href="https://github.com/iqr-lab/iqr-vision" target="_blank" rel="noopener noreferrer">this repository</a> and run:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">pip <span class="token function">install</span> <span class="token parameter variable">-e</span> <span class="token builtin class-name">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Each host should have <code>librealsense2</code> properly installed and have a camera connected. You can test this with the following command:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">iqr-vision <span class="token builtin class-name">test</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>or if you prefer to use <code>runpy</code></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">python <span class="token parameter variable">-m</span> iqr_vision.cli <span class="token builtin class-name">test</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Expected output for each host:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">Connected devices:</span>
<span class="line"><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>USB<span class="token punctuation">]</span> Intel RealSense D455 s/n <span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>, update serial number: <span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span>, firmware version: <span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h2 id="usage" tabindex="-1"><a class="header-anchor" href="#usage"><span>Usage</span></a></h2><h3 id="multivideo" tabindex="-1"><a class="header-anchor" href="#multivideo"><span><code>multivideo</code></span></a></h3><p>This module is specifically used for rgb color related functions. See the relevant function documentation for more details.</p><p>You must first install the <code>iqr-multivideo</code> executable to the edge nodes. Please do this through the cli:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">iqr-vision <span class="token function">install</span> multivideo</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Note: <strong>Ensure that you call <code>multivideo.close()</code> after <code>multivideo.start()</code></strong>. The start function is running an executable under the hood, which will terminate eventually on its own after the required duration, but subsequent runs will fail as the camera stream is already occupied. This is avoided by the <code>pre_stop: bool = True</code> parameter on the <code>multivideo.start()</code></p><p>Example usage:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path</span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> iqr_vision <span class="token keyword">import</span> multivideo</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">record_timestamps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">import</span> time</span>
<span class="line"></span>
<span class="line">    timestamps<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">    before_loop <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">while</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> before_loop <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">:</span> <span class="token comment"># Record for 10 seconds</span></span>
<span class="line">        nano <span class="token operator">=</span> time<span class="token punctuation">.</span>time_ns<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        timestamps<span class="token punctuation">.</span>append<span class="token punctuation">(</span></span>
<span class="line">            <span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>nano <span class="token operator">//</span> <span class="token number">1_000_000_000</span><span class="token punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>nano <span class="token operator">%</span> <span class="token number">1_000_000_000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>zfill<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span>  <span class="token comment"># Record timestamps for every 50ms</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> timestamps</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">pids <span class="token operator">=</span> multivideo<span class="token punctuation">.</span>start<span class="token punctuation">(</span>duration<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span> bag_path<span class="token operator">=</span><span class="token string">&quot;~/test_dir/test.bag&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">timestamps <span class="token operator">=</span> record_timestamps<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">multivideo<span class="token punctuation">.</span>stop<span class="token punctuation">(</span>pids<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">multivideo<span class="token punctuation">.</span>transfer<span class="token punctuation">(</span>local_bag_dir<span class="token operator">=</span><span class="token string">&quot;bags/&quot;</span><span class="token punctuation">,</span> remote_bag_path<span class="token operator">=</span><span class="token string">&quot;~/test_dir/test.bag&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">multivideo<span class="token punctuation">.</span>docker_filter_rosbag<span class="token punctuation">(</span></span>
<span class="line">    local_bag_dir<span class="token operator">=</span><span class="token string">&quot;bags/&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> bag_path <span class="token keyword">in</span> Path<span class="token punctuation">(</span><span class="token string">&quot;bags/filtered_bags&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">&quot;*.bag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    multivideo<span class="token punctuation">.</span>save_rosbag_images<span class="token punctuation">(</span></span>
<span class="line">        local_bag_path<span class="token operator">=</span>bag_path<span class="token punctuation">,</span></span>
<span class="line">        destination_dir<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f&quot;images/</span><span class="token interpolation"><span class="token punctuation">{</span>bag_path<span class="token punctuation">.</span>stem<span class="token punctuation">}</span></span><span class="token string">/&quot;</span></span><span class="token punctuation">,</span></span>
<span class="line">        timestamps<span class="token operator">=</span>timestamps<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="contributing" tabindex="-1"><a class="header-anchor" href="#contributing"><span>Contributing</span></a></h2><p>This is a relatively straightforward Python package, proceed with standard practices. Document functions with <a href="https://github.com/google/styleguide/blob/gh-pages/pyguide.md#38-comments-and-docstrings" target="_blank" rel="noopener noreferrer">Google format Python docstrings</a> and format code with <code>black</code>.</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/iqr-lab/docs/edit/main/computer-vision/iqr-vision.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->Edit this page<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: song.neil.song@gmail.com">Neil Song</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/docs/computer-vision/pointcloud-stitching.html" aria-label="Pointcloud Stitching for IQR Lab"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Pointcloud Stitching for IQR Lab</span></div></a><!----></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/docs/assets/app-Cb7Gj5tc.js" defer></script>
  </body>
</html>
